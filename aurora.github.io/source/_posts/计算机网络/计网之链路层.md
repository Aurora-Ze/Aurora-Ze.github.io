---
title: 计网——链路层
categories: 计算机网络
---

# 链路层

## 基本概念

结点：主机、路由器

链路：两个结点之间的物理通道

数据链路：逻辑通道，链路加上硬件软件

帧：链路层的协议数据单元，封装了网络层数据包

## 一、封装成帧

### 1. 描述

> 在一段数据的前后添加首部和尾部，形成帧
>
> 接收方收到物理层的比特流后，可以根据首部尾部的标记，识别出帧的开始和结束位置

![12844](https://gitee.com/aurora1004/pictures/raw/master/12844.png)

### 2. 区分帧的几种方法

- **字符计数法**

  帧首部用第一个字节表示这个帧的长度

  发生错误后影响之后所有的帧

- **字符填充法**

  特定的首部尾部来作为界限，中间如果遇到同名的，填充字节来转义

- **零比特填充法**

  发送方根据规则填充0，然后接收方去掉首部尾部后，对数据按规则删除0

- **违规编码法**

  用独特的电压来表示首部尾部

## 二、差错检验

### 1. 错误有哪些？

- 位错，比特位发生变动
- 帧错，帧丢失、重复、乱序等

错误来源于外界的冲击噪声或者随机噪声（热噪声）。

### 2. 差错控制方法

这里主要针对比特错，即位错。

相应的解决方法有两类，**检错编码**和**纠错编码**，顾名思义，一个是检查错误，一个是纠正错误。

### 3. 检错编码

这里都用到了`冗余编码`的思想，即发送时在数据前面加上一段比特，接收方根据它来判断数据是否变化

**『奇偶校验码』**

冗余码：只使用1位，取0或1

冗余码取值：满足`数据+冗余码`中`1`的个数是奇数还是偶数（奇校验还是偶校验）

思想：约定奇或偶校验，然后发生方设置冗余码并满足校验，接收方收到后判断1的个数是否和约定的校验方式相符。

例如，现有数据编码`1100101`，采用偶校验的话，要保证添加冗余码后有偶数个1，所以冗余码选择0就可以，编码后为`01100101`

**特点：只能检测出奇数位发生错误的情况**

**『循环冗余码CRC』**

冗余码：有多位，根据计算得到。

思想：

1. 约定一个多项式
2. 数据比特在末尾添`阶数`个0
3. 添零后的数据与多项式进行模2除法，得到冗余码并填充在末尾的0中
4. 接收方让数据除以约定的多项式，除尽了说明没错

图片描述

发送方计算冗余码

![Snipaste_2021-04-29_22-11-00](https://gitee.com/aurora1004/pictures/raw/master/Snipaste_2021-04-29_22-11-00.png)

接收方校验

![](https://gitee.com/aurora1004/pictures/raw/master/20210429230102.png)

### 4. 纠错编码

纠错编码介绍一个叫做`海明码`的方法。

> 海明码是广泛用于内存和磁盘纠错的编码。

1. **首先先要知道冗余码的位数**

   通过`海明不等式`来确定

   根据  $n + r \leq\ 2^r - 1$计算得到，其中n表示数据位数，r表示冗余码位数。

2. **确定校验码和数据的位置**

   把校验码依次放在$2^i$的位置，然后数据依次填充。

3. **计算冗余码的值**

   需要分组，按`XXX1`、`XX1X`、`X1XX`、`1XXX`来分组

   然后冗余位的取值要满足该组的1的个数为偶数

   PS：冗余位取值，可以用`异或后结果为0`来计算

4. **接收方判断**

   收到数据后，进行分组并重新计算每组的异或值

   将值`倒序`排列，得到的十进制即出错的位置。

## 三、流量控制

> 思想：当发送方发送的帧太多，以致接收方来不及处理的时候，接收方就不进行回复确认，来达到**控制发送方速率**的目的

### 流量控制的方法

主要思想是`滑动窗口`，发送方维持一个`固定`的窗口，发送帧之后，接收方回复确认，发送方收到确认消息后，更新窗口中的帧。

与流量控制相关的协助主要有3种，分别是**停止-等待协议**、**后退N帧协议**和**选择重传协议**。

下面就依次介绍一下。

### 停等协议

在`停止-等待协议`中，发送方发送一个帧，就会停下来等待确认消息，收到确认后再发送下一个帧。

如果在超时时间内没有收到确认消息，就进行重传。

懂得都懂，这样做发送方大部分时间都在等待，信道利用率比较低！

#### 优化思想

> 思考：为什么要一帧一帧地发送？可以发送多个帧吗？多个帧发送，又会涉及到顺序的问题

针对以上思考，我们提出两种优化思路：

1. 为帧添加序号
2. 多个帧一起发送

后面介绍的两种协议就采用了这些思路。

### 后退N帧协议（GBN）

**主要思想：发送方维持一个大于1的滑动窗口，每收到一个ACK，移动窗口；接收方维持大小为1的窗口，逐个接收**

**特点：**

- 累计确认

  一旦确认某个帧被接收，那么该帧的前面所有帧也都是确定被接收方收到的

- 超时重传机制

  超时时发送方发送所有未确认的帧

**例子：**假设有编号为0~7的帧，现在发送方收到了0，2，3帧的ACK，如果这时产生了超时，要重新发送些帧

**答案：** {% hideInline 4，5，6，7,查看答案,#FF7242,#fff %}

**缺点：**重传时，要把未确认的帧全都重新传一遍，没有必要

下一个协议就避免了这一缺点。

### 选择重传协议（SR）

**主要思想：发送方维持一个大于1的滑动窗口，每收到一个ACK，移动窗口；接收方维持同样大小的窗口，缓存接收**

注意，因为SR协议接收方窗口大小不为1，所以遇到不连续的数据，它是可以先缓存接收的；等到前面的数据也收到后，就形成连续的帧号，窗口就可以移动了。这和GBN只能接收当前一个帧，不连续就丢弃的情况不同。

## 四、其他协议

### 1.ALOHA

想发数据就发

### 2.CSMA

先监听信道，看看拥不拥挤再发

### 3.CSMA/CD

一边监听一边发，如果拥挤了就停下来

### 4.CSMA/CA

先听后发，适用于传输介质为无线局域网的，所以更常用。

### 广域网

覆盖范围从几十公里到几千公里的网络，它是通过`交换机`来交换分组的。

顺便一提，路由器是网络层的设备，也是用来进行分组交换的，两者的区别在于交换机只能在单个网络中转发分组，而路由器能在多个网络中转发分组。

### 5.PPP协议（点对点协议）

面向字节

用户使用拨号电路接入因特网时，一般使用PPP协议。

### 6.HDLC协议

在同步网上传输数据，面向比特的数据链路层协议