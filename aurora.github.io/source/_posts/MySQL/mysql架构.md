---
title: 笔记2
categories: MySQL
---



<img src="https://gitee.com/aurora1004/pictures/raw/master/mysql-struct.png" alt="mysql-struct" style="zoom:150%;" />

### mysql架构

#### 一、层次划分

主要分为三个层次：

- MySQL Server层
- 存储引擎层
- 文件系统层

#### 二、MySQL Server层

Server层包括**连接层**和**SQL层**

> 注意，图上的Connectors不属于任何一层，可以将 Connectors 理解为各种客户端、应用服务，主要进行是不同语言与 SQL 的交互。

**1. 连接层**

即**Connection Pool**部分，当应用程序通过接口（JDBC、ODBC）连接MySQL时，最先接触到的是连接层。

连接层包括以下三部分

- 通信协议

负责检测客户端版本是否兼容MySQL服务端

- 线程处理

对每个连接请求分配一个线程

- 用户名密码认证

验证用户的账号密码即host主机授权是否可以连接到MySQL服务器

**Connection Pool（连接池）**

> 将用户连接、用户名、密码、权限校验、线程处理等需要缓存的需求缓存下来，下次可以直接用已经建立好的连接，提升服务器性能。

**2. SQL层**

SQL 层是 MySQL 的核心，MySQL 的核心服务都是在这层实现的。主要包含**权限判断、查询缓存、解析器、预处理、查询优化器、缓存和执行计划。**

- **权限判断**可以审核用户有没有访问某个库、某个表，或者表里某行数据的权限。
- **查询缓存**通过 Query Cache 进行操作，如果数据在 Query Cache 中，则直接返回结果给客户端，不必再进行查询解析、优化和执行等过程。
- **查询解析器**针对 SQL 语句进行解析，判断语法是否正确。
- **预处理器**对解析器无法解析的语义进行处理。
- **查询优化器**对 SQL 进行改写和相应的优化，并生成最优的执行计划，就可以调用程序的 API 接口，通过存储引擎层访问数据。

**SQL层具体内容如下：**

|              名称               |                             说明                             |
| :-----------------------------: | :----------------------------------------------------------: |
| Management Services & Utilities | MySQL 的系统管理和控制工具，包括备份恢复、MySQL 复制、集群等。 |
|          SQL Interface          | 用来接收用户的 SQL 命令，返回用户需要查询的结果。例如 SELECT FROM 就是调用 SQL Interface。 |
|      Parser（查询解析器）       | 在 SQL 命令传递到解析器的时候会被解析器验证和解析，以便 MySQL 优化器可以识别的数据结构或返回 SQL 语句的错误。 |
|     Optimizer（查询优化器）     | SQL 语句在查询之前会使用查询优化器对查询进行优化，同时验证用户是否有权限进行查询，缓存中是否有可用的最新数据。它使用“选取-投影-连接”策略进行查询。  例如 `SELECT id, name FROM student WHERE gender = "女";`语句中，SELECT 查询先根据 WHERE 语句进行选取，而不是将表全部查询出来以后再进行 gender 过滤。SELECT 查询先根据 id 和 name 进行属性投影，而不是将属性全部取出以后再进行过滤，将这两个查询条件连接起来生成最终查询结果。 |
|        Caches & Buffers         | 如果查询缓存有命中的查询结果，查询语句就可以直接去查询缓存中取数据。这个缓存机制是由一系列小缓存组成的，比如表缓存、记录缓存、key 缓存、权限缓存等。 |

#### 三、存储引擎层

即上图的**Pluggable Storage Engines**

本层主要负责数据的**存储和读取**

#### 四、文件系统层

功能：

- 将数据存储到操作系统的文件系统内

- 并负责完成与存储引擎的交互