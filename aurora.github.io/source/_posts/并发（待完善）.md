---
title: 并发(待完善)
description: haha
categories: 线程和线程池
---



# Java并发

#### 一、多线程的优缺点

- **优点**

和进程相比，线程的调度和切换成本更小。

多核CPU能够让多个线程同时运行，还能减少线程上下文切换的开销，提高CPU利用率

- **缺点**

可能会遇到**内存泄漏、死锁、线程不安全**的情况

- **补充**

Java内存泄漏：主要是由于长生命周期的对象持有短生命周期的引用，如集合里存放类对象

#### 二、死锁

- 互斥性

> 同一时间只能有一个线程持有某个对象的锁

- 可见性

> 锁释放之前，共享变量的修改要对其他线程可见

------

**Java内存模型：**

内存分为`主内存`和`工作内存`

`主内存`是所有线程共享的，如**堆、方法区**

`工作内存`是线程私有的区域，如**虚拟机栈、程序计数器**等

------

**volatile**关键字的作用：

1. **保证线程间变量的可见性**

一个变量如果用**volatile**修饰，那么：

①某个线程修改变量后，要写回主内存中

②某个线程要读取该变量时，要从主内存中读，而不是缓存

2. **禁止指令重排序**

注意：volatile不保证原子性

#### 三、锁

1. **互斥锁**
2. **偏向锁**

背景：在多数情况下，锁不仅不存在多线程竞争，而且还总是由同一线程多次获得

目的：让线程获得锁的代价更低

实现：

一个线程想要获取对象锁时，先查看对象头的锁记录里是否有线程ID

如果有，直接获取锁

如果设置了，说明是其他线程获得了锁，就发起竞争，由**偏向锁**变为**轻量级锁**



