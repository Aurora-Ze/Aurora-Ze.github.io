---
title: 类加载过程
categories: JVM
---

## 一、类加载过程

要把一个类的Class文件加载到Java虚拟机中，大致分为三个步骤：**加载、连接和初始化**

### 加载

把字节流中的静态数据结构，加载到JVM中，形成运行时的数据结构

### 连接

连接又可以细分成：验证、准备和解析。

#### 1.验证

即验证Class文件是否符合规范，同时对语义进行确认

#### 2.准备

为类级变量分配内存空间，并设置初始值。

PS：实例变量并不分配，因为它是和对象实例绑定在一起的，要在实例化对象的时候才会进行内存分配。

#### 3.解析

把常量池中符号引用解析成指针或者偏移量。

PS：不然光靠一个名称去找它，多累啊；还是知道准确地址好点。

### 初始化

遇到四个关键字时，对类进行初始化操作。

## 二、加载机制

类的加载是通过**加载器**来完成的，具体的加载机制是**双亲委派机制**

### 加载器

Java自带的有3种，**引导类加载器、扩展类加载器**和**应用程序类加载器**

这三者的关系是祖孙三代的关系，来张图表示下吧

<img src="https://gitee.com/aurora1004/pictures/raw/master/classloader.png" alt="classloader_WPS图片" style="zoom:67%;" />

### 双亲委派机制

双亲委派机制，就是指要加载某个类时，向上传递请求，一直到启动类加载器

然后依次判断能不能加载，不能的话再往下传。

### 为什么要这样做呢？

