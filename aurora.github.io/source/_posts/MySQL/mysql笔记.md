---

title: 笔记1
categories: MySQL
---

#### 一、索引

- **定义**

> 是帮助MYSQL高效获取数据的**排好序**的**数据结构**

- **那么该采用什么样的数据结构呢？**

二叉树、红黑树（二叉平衡树）都是不错的

但数据量过大时，树高度会很大，查找数据时会经过多个节点

B+树（多叉平衡树）的话，有多个叉，因此可以有效的减小高度，所以采用**B+树**的结构来构建索引较合适。

- **B树和B+树的区别**

①B树的叶子节点指针为空，而B+树的叶子节点还有双向指针指向左右两边，**提高区间的访问性**

②B树每个节点都存放数据，B+树只有叶子节点存放了数据

#### 二、存储引擎

首先，要明确一点，存储引擎是修饰表结构的。

目前主要有两种引擎，**MyISAM**和**InnoDB**（现在流行）

他们都是用B+树的索引结构来构建表的，不同之处在于：

> MyISAM的索引和数据是分离在两个文件中的，索引结构的叶子节点存放数据所在的磁盘地址，根据地址去访问数据
>
> InnoDB的数据就放在叶节点

**为什么建议InnoDB表尽量建主键，并且要是整型自增的？**

因为不是自增的话，构建B+树时发生分裂和冗余的次数会增多

#### 三、联合索引

即多个属性作为索引，构建树时，按照声明的属性顺序来排序

**索引最左前缀原则**

查找记录时，条件里的列属性必须是联合索引从左到右顺序的，不能跳，才会走索引来查找

例如  有联合索引(name，age，job)   查找语句 select * from table where name = 123 and age = 213 会走索引

**走索引**

> 从B+树的根节点开始，向下查找

**如果不走索引，会怎么查找呢？**

会从B+树的最左叶子节点，开始向右查找，即全表扫描。

**如果一个表既创建了主键索引，又创建了联合索引，那么联合索引的B+树结构是怎么样的？**

首先，明确一点，如果像主键索引那样建表（即索引节点+叶子节点放数据），就意味着表的数据要复制一份给联合索引，会造成数据冗余

那么可以只存放必要的数据，即联合索引的多个主键的数据，这样能保证索引到叶子，然后只要叶子节点存放对应的主键索引，就可以去主键索引里找到整条数据。

#### 五、InnoDB索引

`InnoDB`把索引分为两类，**聚集索引**和**二级索引**

> **聚集索引**，就是能**唯一确定**数据的逻辑位置和物理位置的索引，在一个表中，只能有一个聚集索引。
>
> 除了聚集索引以外的其他索引，都是二级索引。

**聚集索引选择：**

1. `InnoDB`会把主键作为聚集索引

2. 如果一个表没有设置主键，那么它会找一个唯一且非空的字段作为聚集索引
3. 如果找不到合适字段，就会创建一个名为`GEN_CLUST_INDEX`的隐式字段作为聚集索引。

**聚集索引的好处：**加快查询速度

**怎么加快：**查询时，直接地访问到数据行

**二级索引和聚集索引的关系：**

二级索引中的每条记录都包含了聚集索引的主键列的值，也包含了二级索引定义的字段列的值

然后通过二级索引查找，最终会根据主键值到聚集索引中去查找数据。

因此，主键不要过长，不然二级索引也会占用很多空间。